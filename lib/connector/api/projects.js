"use strict";function create(a,b){utils.ajax("http://"+f3domain+"/projects"+utils.querify(a),function(a,c){switch(c){case 200:return console.log("registration succeeded:",a),void(b&&b(null,new base.Project(a)));case 400:console.log("invalid data:",a);break;case 403:console.log("access denied");break;default:console.log("server error:",a)}b&&b("undefined"==typeof a?{}:a,null)},"json","post")}function findDescendant(a,b){utils.ajax("http://"+f3domain+"/projects/"+a+utils.querify({find:"descendant",format:"json"}),function(a,c){b(404===c||null===a?null:new base.Project(a))},"json")}function read(a,b){return null!==projectCache&&projectCache.id===a?(b&&setTimeout(function(){b(projectCache)},1),!0):void utils.ajax("http://"+f3domain+"/projects/"+a+utils.querify({format:"json"}),function(a,c){var d=null===a||200!==c?null:new base.Project(a);null!==d&&(projectCache=d),b&&b(d)},"json")}function list(a,b){var c=_.extend({format:"json",withoutOriginalAuthors:!0},b);utils.ajax("http://"+f3domain+"/projects"+utils.querify(c),function(b){if(!b)return a(null,{});var c=b.list;delete b.list,a(_.map(c,function(a){return new base.Project(a)}),b)},"json")}function listVariants(a,b){var c=_.extend({format:"json",withoutAuthors:!0,withoutOriginalAuthors:!0},b);utils.ajax("http://"+f3domain+"/variants"+utils.querify(c),function(b){if(!b)return a(null,{});var c=b.list;delete b.list,a(_.map(c,function(a){return new base.Variant(a)}),b)},"json")}function listAuthors(a,b){utils.ajax("http://"+f3domain+"/users/for/projects/"+a,function(a,c){return 404!==c&&a?void(b&&b(_.map(a,function(a){return new base.User(a)}))):void(b&&b(null))},"json")}function createVariant(a,b){utils.ajax("http://"+base.getServerDomainName()+"/variants"+utils.querify(a),function(a,c){if(200!==c||!a)return void(b&&b(null));var d=new base.Variant(a);download(d),b&&b(d)},"json","post")}function download(a,b){void 0===b&&(b="");var c=document.createElement("a"),d=a.contentType===base.Variant.PROGRAM_NODEJS;c.setAttribute("href",a.getDownloadLinkUrl()),c.setAttribute("download","f3js-"+(d?"nodejs-":"layout-")+a.id+(d?"zip"===b?".zip":".tar.gz":".pdf")),c.style.display="none",document.body.appendChild(c),c.click(),setTimeout(function(){document.body.removeChild(c)},1e3)}var _=require("underscore"),base=require("../models/base"),utils=require("../utils"),f3domain=base.getServerDomainName(),projectCache=null;exports.create=create,exports.findDescendant=findDescendant,exports.read=read,exports.list=list,exports.listVariants=listVariants,exports.listAuthors=listAuthors,exports.createVariant=createVariant,exports.download=download;/*! f3js-cli - v0.0.2 - 2016-06-23 */
