"use strict";function msg(){return new Promise(function(a,b){return null!==message?a(message):void ajax("http://"+base.getServerDomainName()+"/message.json",function(c){return c?(message=c,void a(message)):b()},"json")})}function getMsg(){return message}function setToken(a){token=a}function getUser(){return userObj||self.user&&(userObj=new base.User(self.user)),userObj}function isExternalSite(){return base.getServerDomainName()!==location.host}function isUrl(a){return a.length<2083&&urlRegexp.test(a)}function getDateString(a){return base.getDateString(a)}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}function setCookie(a,b,c){void 0===c&&(c=365);var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e}function parseQueryString(){if(!location||!location.search)return{};var a=location.search,b={};return"?"!==a.charAt(0)?{}:(_.each(a.substring(1).split("&"),function(a){var c=a.substring(0,a.indexOf("=")),d=a.substring(c.length+1);b[c]=d}),b)}function querify(a){return a?_.reduce(_.map(a,function(a,b){var c="undefined"==typeof a?null:encodeURIComponent(b)+"="+(a?encodeURIComponent(a.toString()):"");return c}),function(a,b){return b?(a?a+"&":"?")+b:a},null):""}function ajaxWithCredentials(a){withCredentialsCallback=a}function ajax(a,b,c,d){if(void 0===c&&(c="text"),void 0===d&&(d="GET"),a){var e;if("undefined"!=typeof ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){e=!1}}else if("undefined"!=typeof XMLHttpRequest)try{e=new XMLHttpRequest}catch(f){e=!1}else try{var g=require("xhr2");e=new g}catch(f){e=!1}if(e){c=c.toLowerCase(),d=d.toUpperCase();var h=null,i=a.split("?");if("POST"==d&&(a=i[0],i.length>1&&(h=i[1])),token&&0===a.indexOf("http://"+base.getServerDomainName())&&("POST"==d?(i.length>1?h+="&":h="",h+="access-token="+token):(a+=i.length>1?"&":"?",a+="access-token="+token)),e.open(d,a),"undefined"!=typeof self&&self.debug){var j=/([&?])access-token=(.+)$/.exec(a);j&&(a=a.substring(0,a.length-j[2].length)+"*"),console.log(d,a)}var k=withCredentialsCallback(a);k&&(e.withCredentials=!0),"POST"==d&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4===e.readyState){var a="";if(e.responseText&&(a=e.responseText),"j"==c.charAt(0))try{a=JSON.parse(a)}catch(d){a=null}else"x"==c.charAt(0)&&(a=e.responseXML);"undefined"==typeof a&&(a=null),b&&b(a,e.status)}},e.send(h)}}}var PromiseModule=require("es6-promise");"undefined"==typeof self||self.Promise||(self.Promise=PromiseModule.Promise);var _=require("underscore"),base=require("./models/base"),message=null;exports.msg=msg,exports.getMsg=getMsg;var token=null;exports.setToken=setToken;var userObj=null;exports.getUser=getUser,exports.isExternalSite=isExternalSite;var urlRegexp=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i");exports.isUrl=isUrl,exports.getDateString=getDateString,exports.getCookie=getCookie,exports.setCookie=setCookie,exports.parseQueryString=parseQueryString,exports.querify=querify;var withCredentialsCallback=function(a){return!1};exports.ajaxWithCredentials=ajaxWithCredentials,exports.ajax=ajax;/*! f3js-cli - v0.0.3 - 2016-06-23 */
