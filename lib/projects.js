#! /usr/bin/env node
"use strict";function render(a){var b=a.toJSON();if(b.author){var c=b.author;delete b.author,b.author=c.displayName}var d=b.id;delete b.id,delete b.script,delete b.packageJson,console.log("project id",d),console.log(b)}var _=require("underscore"),Download=require("download"),utils=require("./utils"),base=require("./connector/models/base"),projects=require("./connector/api/projects"),doList=null,doGet=null,doDownload=null;utils.init(function(a){a.command("list").description("list up projects").option("-o, --offset <n>","Offset index",parseInt).action(function(a){doList=function(){var b={};a.offset&&(b.startIndex=a.offset),projects.list(function(a,b){a&&(console.log("next offset",b.nextStartIndex?b.nextStartIndex:-1),_.each(a,function(a){return render(a)}))},b)}}),a.command("get <id>").description("get project information").action(function(a){doGet=function(){return a?void projects.read(a,function(a){return a?void render(a):void console.log(null)}):void console.log(null)}}),a.command("download <id>").description("download project archive").option("-e, --extract","Extract the archive").action(function(a,b){doDownload=function(){if(!a)return void console.log(null);var c=!!b.extract;projects.read(a,function(a){if(!a)return void console.log(null);var b=new base.Variant({script:a.script,projectId:a.id,parametersJson:{},contentType:base.Variant.PROGRAM_NODEJS,isPrivate:a.isPrivate});b=b.toJSON(),b.archiver="tar.gz",projects.createVariant(b,function(a){return a?void new Download({extract:c}).get(a.getDownloadLinkUrl()).dest(c?a.getFileBaseName():".").rename(function(b){return c?b:(b.basename=a.getFileBaseName(),b.extname=a.getFileExtension(),b)}).run(function(b,d){return b?void console.error(b):void console.log(c?a.getFileBaseName():a.getFileName())}):void console.log(null)})})}})}),doList&&doList(),doGet&&doGet(),doDownload&&doDownload();/*! f3js-cli - v0.0.3 - 2016-06-23 */
