#! /usr/bin/env node
"use strict";function render(a){var b=a.toJSON();if(b.author){var c=b.author;delete b.author,b.author=c.displayName}var d=b.id;delete b.id,delete b.script,delete b.packageJson,console.log("project id",d),console.log(b)}function download(a,b){void 0===b&&(b=!1),new Download({extract:b}).get(a.getDownloadLinkUrl()).dest(b?a.getFileBaseName():".").rename(function(c){return b?c:(c.basename=a.getFileBaseName(),c.extname=a.getFileExtension(),c)}).run(function(c,d){return c?void console.error(c):void console.log(b?a.getFileBaseName():a.getFileName())})}var _=require("underscore"),Download=require("download"),utils=require("./utils"),base=require("./connector/models/base"),projects=require("./connector/api/projects"),doList=null,doGet=null,doDownload=null,doDownloadVar=null;utils.init(function(a){a.command("list").description("list up projects").option("-o, --offset <n>","Offset index",parseInt).action(function(a){doList=function(){var b={};a.offset&&(b.startIndex=a.offset),projects.list(function(a,b){a&&(console.log("next offset",b.nextStartIndex?b.nextStartIndex:-1),_.each(a,function(a){return render(a)}))},b)}}),a.command("get <id>").description("get project information").action(function(a){doGet=function(){return a?void projects.read(a,function(a){return a?void render(a):void console.log(null)}):void console.log(null)}}),a.command("download <id>").description("download project archive").option("-e, --extract","Extract the archive").action(function(a,b){doDownload=function(){if(!a)return void console.log(null);var c=!!b.extract;projects.read(a,function(a){if(!a)return void console.log(null);var b=new base.Variant({script:a.script,projectId:a.id,parametersJson:{},contentType:base.Variant.PROGRAM_NODEJS,isPrivate:a.isPrivate});b=b.toJSON(),b.archiver="tar.gz",projects.createVariant(b,function(a){return a?void download(a,c):void console.log(null)})})}}),a.command("download-var <id>").description("download a variation of the project archive").option("-e, --extract","Extract the archive").action(function(a,b){doDownloadVar=function(){if(!a)return void console.log(null);var c=!!b.extract;projects.readVariant(a,function(a){return a?(a.contentType=base.Variant.PROGRAM_NODEJS,a.archiver="tar.gz",void download(a,c)):void console.log(null)})}})}),doList&&doList(),doGet&&doGet(),doDownload&&doDownload(),doDownloadVar&&doDownloadVar();/*! f3js-cli - v0.0.4 - 2016-06-23 */
